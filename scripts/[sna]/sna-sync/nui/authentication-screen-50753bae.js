import{r as d,j as n,o as j,d as O,u as U,f as q,N as _,c as F}from"./index-f8ae11f0.js";import{$ as P,a as z,b as Y,c as Q,d as H,e as K,f as G,B as S,u as J,L as W,h as X}from"./fetch.client-5a067be0.js";import{$ as Z,a as ee,L as ae,E as te}from"./label-c3628353.js";function ie(e,a,t){let r=d.useRef(a),o=P(()=>{t&&t(r.current)});d.useEffect(()=>{var i;let s=e==null||(i=e.current)===null||i===void 0?void 0:i.form;return s==null||s.addEventListener("reset",o),()=>{s==null||s.removeEventListener("reset",o)}},[e,o])}function re(e,a,t){let{validationBehavior:r,focus:o}=e;z(()=>{if(r==="native"&&(t!=null&&t.current)){let l=a.realtimeValidation.isInvalid?a.realtimeValidation.validationErrors.join(" ")||"Invalid value.":"";t.current.setCustomValidity(l),t.current.hasAttribute("title")||(t.current.title=""),a.realtimeValidation.isInvalid||a.updateValidation(oe(t.current))}});let i=P(()=>{a.resetValidation()}),s=P(l=>{var u;a.displayValidation.isInvalid||a.commitValidation();let f=t==null||(u=t.current)===null||u===void 0?void 0:u.form;if(!l.defaultPrevented&&t&&f&&le(f)===t.current){var m;o?o():(m=t.current)===null||m===void 0||m.focus(),Y("keyboard")}l.preventDefault()}),c=P(()=>{a.commitValidation()});d.useEffect(()=>{let l=t==null?void 0:t.current;if(!l)return;let u=l.form;return l.addEventListener("invalid",s),l.addEventListener("change",c),u==null||u.addEventListener("reset",i),()=>{l.removeEventListener("invalid",s),l.removeEventListener("change",c),u==null||u.removeEventListener("reset",i)}},[t,s,c,i,r])}function ne(e){let a=e.validity;return{badInput:a.badInput,customError:a.customError,patternMismatch:a.patternMismatch,rangeOverflow:a.rangeOverflow,rangeUnderflow:a.rangeUnderflow,stepMismatch:a.stepMismatch,tooLong:a.tooLong,tooShort:a.tooShort,typeMismatch:a.typeMismatch,valueMissing:a.valueMissing,valid:a.valid}}function oe(e){return{isInvalid:!e.validity.valid,validationDetails:ne(e),validationErrors:e.validationMessage?[e.validationMessage]:[]}}function le(e){for(let a=0;a<e.elements.length;a++){let t=e.elements[a];if(!t.validity.valid)return t}return null}const k={badInput:!1,customError:!1,patternMismatch:!1,rangeOverflow:!1,rangeUnderflow:!1,stepMismatch:!1,tooLong:!1,tooShort:!1,typeMismatch:!1,valueMissing:!1,valid:!0},N={...k,customError:!0,valid:!1},E={isInvalid:!1,validationDetails:k,validationErrors:[]},se=d.createContext({}),L="__formValidationState"+Date.now();function de(e){if(e[L]){let{realtimeValidation:a,displayValidation:t,updateValidation:r,resetValidation:o,commitValidation:i}=e[L];return{realtimeValidation:a,displayValidation:t,updateValidation:r,resetValidation:o,commitValidation:i}}return ue(e)}function ue(e){let{isInvalid:a,validationState:t,name:r,value:o,builtinValidation:i,validate:s,validationBehavior:c="aria"}=e;t&&(a||(a=t==="invalid"));let l=a!==void 0?{isInvalid:a,validationErrors:[],validationDetails:N}:null,u=d.useMemo(()=>T(ce(s,o)),[s,o]);i!=null&&i.validationDetails.valid&&(i=null);let f=d.useContext(se),m=d.useMemo(()=>r?Array.isArray(r)?r.flatMap(v=>A(f[v])):A(f[r]):[],[f,r]),[y,w]=d.useState(f),[V,g]=d.useState(!1);f!==y&&(w(f),g(!1));let x=d.useMemo(()=>T(V?[]:m),[V,m]),M=d.useRef(E),[$,p]=d.useState(E),b=d.useRef(E),h=()=>{if(!B)return;I(!1);let v=u||i||M.current;C(v,b.current)||(b.current=v,p(v))},[B,I]=d.useState(!1);return d.useEffect(h),{realtimeValidation:l||x||u||i||E,displayValidation:c==="native"?l||x||$:l||x||u||i||$,updateValidation(v){c==="aria"&&!C($,v)?p(v):M.current=v},resetValidation(){let v=E;C(v,b.current)||(b.current=v,p(v)),c==="native"&&I(!1),g(!0)},commitValidation(){c==="native"&&I(!0),g(!0)}}}function A(e){return e?Array.isArray(e)?e:[e]:[]}function ce(e,a){if(typeof e=="function"){let t=e(a);if(t&&typeof t!="boolean")return A(t)}return[]}function T(e){return e.length?{isInvalid:!0,validationErrors:e,validationDetails:N}:null}function C(e,a){return e===a?!0:e&&a&&e.isInvalid===a.isInvalid&&e.validationErrors.length===a.validationErrors.length&&e.validationErrors.every((t,r)=>t===a.validationErrors[r])&&Object.entries(e.validationDetails).every(([t,r])=>a.validationDetails[t]===r)}function ve(e,a){let{inputElementType:t="input",isDisabled:r=!1,isRequired:o=!1,isReadOnly:i=!1,type:s="text",validationBehavior:c="aria"}=e,[l,u]=Z(e.value,e.defaultValue||"",e.onChange),{focusableProps:f}=Q(e,a),m=de({...e,value:l}),{isInvalid:y,validationErrors:w,validationDetails:V}=m.displayValidation,{labelProps:g,fieldProps:x,descriptionProps:M,errorMessageProps:$}=ee({...e,isInvalid:y,errorMessage:e.errorMessage||w}),p=H(e,{labelable:!0});const b={type:s,pattern:e.pattern};return ie(a,l,u),re(e,m,a),d.useEffect(()=>{if(a.current instanceof K(a.current).HTMLTextAreaElement){let h=a.current;Object.defineProperty(h,"defaultValue",{get:()=>h.value,set:()=>{},configurable:!0})}},[a]),{labelProps:g,inputProps:G(p,t==="input"&&b,{disabled:r,readOnly:i,required:o&&c==="native","aria-required":o&&c==="aria"||void 0,"aria-invalid":y||void 0,"aria-errormessage":e["aria-errormessage"],"aria-activedescendant":e["aria-activedescendant"],"aria-autocomplete":e["aria-autocomplete"],"aria-haspopup":e["aria-haspopup"],value:l,onChange:h=>u(h.target.value),autoComplete:e.autoComplete,autoCapitalize:e.autoCapitalize,maxLength:e.maxLength,minLength:e.minLength,name:e.name,placeholder:e.placeholder,inputMode:e.inputMode,onCopy:e.onCopy,onCut:e.onCut,onPaste:e.onPaste,onCompositionEnd:e.onCompositionEnd,onCompositionStart:e.onCompositionStart,onCompositionUpdate:e.onCompositionUpdate,onSelect:e.onSelect,onBeforeInput:e.onBeforeInput,onInput:e.onInput,...f,...x}),descriptionProps:M,errorMessageProps:$,isInvalid:y,validationErrors:w,validationDetails:V}}const D=d.forwardRef(({errorMessage:e,...a},t)=>n.jsx("input",{ref:t,...a,className:j("w-full p-1.5 px-3 rounded-md border outline-none disabled:cursor-not-allowed disabled:opacity-80","transition-colors placeholder:opacity-50","bg-white dark:bg-secondary dark:text-white","border-gray-200 dark:border-quinary focus:border-gray-800 dark:focus:border-gray-500",e&&"border-red-500 dark:border-red-500 focus:border-red-700 dark:focus:border-red-700",a.className)}));D.displayName="Input";const R=d.forwardRef(({errorMessage:e,...a},t)=>n.jsx("textarea",{ref:t,...a,className:j("w-full p-1.5 px-3 rounded-md border outline-none disabled:cursor-not-allowed disabled:opacity-80 resize-y","min-h-[3em] transition-colors placeholder:opacity-50","bg-white dark:bg-secondary dark:text-white","border-gray-200 dark:border-quinary focus:border-gray-800 dark:focus:border-gray-500",e&&"border-red-500 dark:border-red-500 focus:border-red-700 dark:focus:border-red-700",a.className)}));R.displayName="Textarea";function fe({inputRef:e}){const[a,t]=d.useState(!1),r=O.useTranslations("Common");function o(){e.current&&(e.current.type=a?"password":"text",t(i=>!i))}return n.jsx(S,{onPress:o,size:"xs",className:"absolute bg-gray-300 top-[32px] right-1 dark:bg-tertiary w-fit",children:r(a?"hide":"show")})}function me(e){const a=d.useRef(null),t=e.inputRef??a,{labelProps:r,inputProps:o,errorMessageProps:i}=ve({...e,inputElementType:e.isTextarea?"textarea":"input"},t);return n.jsxs("div",{className:j("relative text-field flex flex-col mb-3",e.className),children:[n.jsx(ae,{...e,labelProps:r}),e.isTextarea?n.jsx(R,{errorMessage:e.errorMessage,ref:t,...o}):n.jsx(D,{errorMessage:e.errorMessage,ref:t,...o}),e.children,e.type==="password"&&!e.isTextarea?n.jsx(fe,{inputRef:t}):null,e.errorMessage&&n.jsx(te,{errorMessage:e.errorMessage,errorMessageProps:i})]})}function $e(){var o;const{hide:e,data:a}=U(),t=J({mutationKey:["authentication"],onSuccess(i,s){e(),q(_.OnAuthenticationFlowSuccess,s),F({title:"Authentication Success",message:"You have successfully authenticated with SnailyCAD."})},mutationFn:async i=>{if(!(a!=null&&a.url))throw new Error("SnailyCAD API URL not provided in server.cfg.");const{data:s,error:c,errorMessage:l}=await X({url:a.url,path:"/user/api-token/validate",method:"POST",data:i});if(l||c||!s)throw l==="invalidToken"?new Error("An invalid Personal API Token was provided."):new Error("Could not verify your Personal API Token.");return s}});async function r(i){i.preventDefault();const c=i.currentTarget.elements.namedItem("api_token");c&&await t.mutateAsync({token:c.value})}return n.jsxs("div",{className:"w-[48em] rounded-md bg-primary p-8",children:[n.jsxs("header",{className:"mb-2",children:[n.jsxs("div",{className:"flex items-center justify-between mb-3",children:[n.jsx("h1",{className:"text-2xl font-bold text-white",children:"SnailyCAD Personal API Token Authentication"}),n.jsx(S,{className:"px-1 text-base",onPress:e,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-x",viewBox:"0 0 16 16",children:n.jsx("path",{d:"M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"})})})]}),n.jsxs("p",{children:["Use your Personal API Token found at your CAD URL ","->"," Account ","->"," API Token. ",n.jsx("br",{}),"This will allow you to interact with the CAD from within FiveM."]})]}),n.jsxs("form",{onSubmit:r,className:"mt-3",children:[n.jsx(me,{id:"api_token",errorMessage:(o=t.error)==null?void 0:o.message,label:"Personal API Token",className:"mb-2",type:"password"}),t.data?n.jsx("p",{className:"text-green-400 mb-2 font-medium",children:"You have successfully authenticated with SnailyCAD. You can now close this window."}):null,n.jsxs(S,{className:"flex gap-2 items-center",type:"submit",isDisabled:t.isPending,children:[t.isPending?n.jsx(W,{}):null,"Authenticate"]})]})]})}export{$e as AuthenticationScreen};
